var Services=function(){const e=firebase.firestore(),t=new GeoFirestore(e);e.settings({timestampsInSnapshots:!0});return{getLocations:()=>{e.collection("prize_locations").get().then(e=>{e.forEach(e=>{console.log(e.data().location),console.log(e.id)})})},setPrizeClaimed:(t,o)=>{e.collection("prize_locations").doc(t).update({claimed_by:o})},getPrizesNearLocation:(e,o,n,l)=>{t.collection("prize_locations").near({center:new firebase.firestore.GeoPoint(e,o),radius:n}).where("claimed_by","==","").get().then(e=>{console.log(e.docs),l&&l(e.docs)})},addLocation:e=>{t.collection("prize_locations").add({claimed_by:"",coordinates:new firebase.firestore.GeoPoint(e.lat,e.long)})}}}();AFRAME.registerComponent("clickhandler",{init:function(){this.el.addEventListener("click",()=>{console.log(this.el);const e=this.el.getAttribute("distancemsg");alert(`You are ${e} from the bee`),Common.setCurrentBee(this.el.id),Common.toggleModal(".claim-prize-modal")})}});var Common=function(){let e;const t={asset:"#mug",scale:".04 .04 .04"},o=[];let n,l=0;return toggleFullScreen=(()=>{console.log("make full screen");var e=window.document,t=e.documentElement,o=t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen,n=e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen;e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement?n.call(e):o.call(t)}),setCurrentBee=(e=>{n=o[Number(e)],console.log("THE current bee is",n)}),getCurrentBee=(()=>n),addModelToScene=((e,t,o)=>{const n=document.querySelector("a-scene"),l=document.createElement("a-entity");l.setAttribute("gps-entity-place",`latitude: ${e.latitude}; longitude: ${e.longitude}`),l.setAttribute("gltf-model",t.asset),l.setAttribute("scale",t.scale),l.setAttribute("clickhandler",""),l.setAttribute("animation-mixer",""),l.setAttribute("class","mug"),l.setAttribute("id",o),n.appendChild(l)}),setCurrentUserLocation=(t=>{e=t}),getUserLocation=(e=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(t=>{e&&e(t.coords)})}),addInitialLocations=(()=>{this.getUserLocation(t=>{this.setCurrentUserLocation(t),Services.getPrizesNearLocation(t.latitude,t.longitude,.5,t=>{this.addAllModelsToScene(t),this.setDebugContent(t.length,e,l,0)})})}),addAllModelsToScene=(e=>{e.forEach((e,n)=>{let l=e.data(),s={id:e.id};o.push(Object.assign(e.data(),s)),this.addModelToScene(l.coordinates,t,n)})}),removeModelsFromScene=(()=>{const e=document.querySelectorAll(".mug")||[];o=[],e.forEach(e=>{e.remove()})}),addNewLocations=(()=>{const t=e;t?this.getUserLocation(o=>{const n=this.calcDistanceBetweenGeopoints(t.latitude,t.longitude,o.latitude,o.longitude);console.warn(`The user has moved ${n} kms`),this.updateDistance(n),n&&n>.05&&(this.removeModelsFromScene(),this.setCurrentUserLocation(o),Services.getPrizesNearLocation(o.latitude,o.longitude,.5,t=>{this.addAllModelsToScene(t),l++,this.setDebugContent(t.length,e,l,n)}))}):this.addInitialLocations()}),calcDistanceBetweenGeopoints=((e,t,o,n)=>{var l=toRad(o-e),s=toRad(n-t),a=(e=toRad(e),o=toRad(o),Math.sin(l/2)*Math.sin(l/2)+Math.sin(s/2)*Math.sin(s/2)*Math.cos(e)*Math.cos(o));return 6371*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))}),toRad=(e=>e*Math.PI/180),setDebugContent=((e,t,o,n)=>{let l,s,a,i,c;l=document.querySelector(".num-locations"),s=document.querySelector(".curr-location"),a=document.querySelector(".count-location-changed"),i=document.querySelector(".moved"),c=document.querySelectorAll(".mug"),l.innerHTML=`There are ${c.length} prizes now`,s.innerHTML=`The users last location was ${t.latitude} ${t.longitude}`,a.innerHTML=`The user changed locations ${o}`,i.innerHTML=`The user has moved ${n} kms`}),updateDistance=(e=>{document.querySelector(".moved").innerHTML=`The user has moved ${e} kms`}),toggleModal=(e=>{const t=document.querySelector(e);t.classList.contains("closed")?(t.classList.remove("closed"),t.classList.add("open")):(t.classList.remove("open"),t.classList.add("closed"))}),agreeToLegalText=(()=>{this.toggleModal(".landing-modal"),this.toggleFullScreen()}),{toggleFullScreen:toggleFullScreen,addModelToScene:addModelToScene,locations:o,configOne:t,addInitialLocations:addInitialLocations,addNewLocations:addNewLocations,toggleModal:toggleModal,setCurrentBee:setCurrentBee,agreeToLegalText:agreeToLegalText}}();document.addEventListener("DOMContentLoaded",e=>{console.log("DOM loaded"),setTimeout(()=>{Common.addInitialLocations()},3e3),setInterval(()=>{Common.addNewLocations()},1e4)});